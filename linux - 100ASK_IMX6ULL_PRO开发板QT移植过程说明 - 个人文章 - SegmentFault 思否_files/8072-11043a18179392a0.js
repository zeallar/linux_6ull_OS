"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8072],{88072:function(e,a,s){var t=s(11527),n=s(50959),c=s(21713),i=s(16983),r=s(81159),l=s(57898),o=s(94071),d=s(54883),m=s(90605),u=s(92310),h=s(23970),x=s(68119),f=s(76734),k=s(57448),b=s(78661),p=s(87710),j=s(44868);let v=e=>{let{mode:a="default",id:s,actionData:h={},title:v="",banner:N="",dispatch:g,showShare:w=!1,source:y,showComment:Z=!0,isAuthor:S=!1,sticky:C=!0,style:L={},likeBtnSize:_="lg",showLikeBtn:I=!0,showHateBtn:D=!1,showBookmarkBtn:F=!0,showShareBtn:M=!0,isNotHandle:q={like:!1,hate:!1,haveAccess:!1},isBaiduOxApp:B=!1,realViews:A=0,sessionUser:E}=e,{isLiked:P=!1,votes:T=0,bookmarks:R=0,isBookmarked:U=!1,isHated:H=!1,comments:O=0}=h,[K,$]=(0,n.useState)(T),[z,G]=(0,n.useState)(H),[W,X]=(0,n.useState)(R),[J,Q]=(0,n.useState)(P),[V,Y]=(0,n.useState)(U),[ee,ea]=(0,n.useState)(!1),[es,et]=(0,n.useState)(""),[en,ec]=(0,n.useState)(""),[ei,er]=(0,n.useState)(""),[el,eo]=(0,n.useState)(""),[ed,em]=(0,n.useState)(!1),[eu,eh]=(0,n.useState)(!1),ex=(0,n.useRef)(),ef=(0,n.useRef)(),ek=(0,n.useRef)();(0,n.useEffect)(()=>{var e,a;(null===(e=window.navigator)||void 0===e?void 0:null===(a=e.canShare)||void 0===a?void 0:a.call(e,{text:v}))&&eh(!0)},[]),(0,n.useEffect)(()=>{Q(P),Y(U),$(T),X(R),G(H)},[P,U,T,R,H]),(0,n.useEffect)(()=>{let e="".concat(window.location.origin).concat(window.location.pathname,"?utm_medium=shareLink&utm_campaign=socialShare");E?et("".concat(e,"&share_user=").concat(E.user.id)):et(e),ec("【".concat(v,"】分享自 @segment_fault，传送门：")),er("【".concat(v,"】分享自 @SegmentFault，传送门："))},[es,E]),(0,n.useEffect)(()=>{if(es&&!el){let e=null==document?void 0:document.querySelector(".qrcode");x.toCanvas(e,es,{margin:0},function(e,a){e&&console.error(e),eo(a.toDataURL())})}},[el,es]);let eb=()=>{if(!(0,j.bg)())return;if(q.like){b.ZP.confirm({content:"不能给自己点赞"});return}if(S&&("article"===y||"video"===y)){b.ZP.confirm({content:"你是作者，无法对自己进行此操作"});return}if("product-score"===y&&!q.haveAccess){g({type:"global/saveProductAuthModalState",payload:{isShow:!0,title:"点赞"}});return}let e=z?2:1;$(J?K-e:K+e),Q(!J),G(!1),g({type:"action/saveLike",payload:{id:s,votes:J?K-e:K+e,isLiked:!J,isHated:!1}}),(0,p.vLC)({id:s,type:y,is_like:J?0:1}).catch(()=>{$(K),Q(J),G(z),g({type:"action/saveLike",payload:{id:s,votes:K,isLiked:J,isHated:z}})})},ep=()=>{(0,j.bg)()&&ea(!0)},ej=e=>{X(e?W+1:W-1),Y(e),g({type:"action/saveBookmark",payload:{id:s,bookmarks:e?W+1:W-1,isBookmarked:e}})},ev=()=>{if(!(0,j.bg)())return;if(q.hate){b.ZP.confirm({content:"不能给自己点踩"});return}if("product-score"===y&&!q.haveAccess){g({type:"global/saveProductAuthModalState",payload:{isShow:!0,title:"点踩"}});return}let e=J?2:1;Q(!1),$(z?K+e:K-e),g({type:"action/saveLike",payload:{id:s,votes:z?K+e:K-e,isLiked:!1,isHated:!z}}),(0,p.qne)({id:s,type:y,is_hate:z?0:1}).catch(()=>{G(z),Q(J),$(K),em(z),g({type:"action/saveLike",payload:{id:s,votes:K,isLiked:J,isHated:z}})})},eN=()=>{navigator.share({title:v,text:v+"- SegmentFault 思否，传送门：",url:"".concat(window.location.origin).concat(window.location.pathname)})},eg=(0,t.jsx)(c.Z,{id:"popover-basic",children:(0,t.jsx)(c.Z.Body,{children:"如果该内容有可改进的余地，欢迎通过评论给作者建议。"})}),ew=(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"text-center mt-2",style:{cursor:"auto"},children:[(0,t.jsx)("div",{className:"qr",children:(0,t.jsx)("img",{crossOrigin:"anonymous",src:el,width:"118",height:"118"})}),"扫一扫分享"]}),(0,t.jsx)("div",{className:"dropdown-divider"}),(0,t.jsx)(i.Z.Item,{className:"p-0",onKeyDown:e=>{13===e.keyCode&&ex.current.click()},children:(0,t.jsxs)(d.Z,{title:ei,url:"".concat(es,"&utm_source=Weibo"),image:N,ref:ex,className:"btn w-100 ps-4 pe-4 pt-1 pb-1 text-start",children:[(0,t.jsx)("i",{className:"fab fa-weibo fa-fw"})," 新浪微博"]})}),(0,t.jsx)(i.Z.Item,{className:"p-0",onKeyDown:e=>{13===e.keyCode&&ef.current.click()},children:(0,t.jsxs)(m.Z,{title:en,url:"".concat(es,"&utm_source=Twitter"),ref:ef,className:"btn w-100 ps-4 pe-4 pt-1 pb-1 text-start",children:[(0,t.jsx)("i",{className:"fab fa-twitter fa-fw"})," Twitter"]})}),(0,t.jsx)(i.Z.Item,{className:"p-0",onKeyDown:e=>{13===e.keyCode&&ek.current.click()},children:(0,t.jsxs)(u.Z,{title:en,url:"".concat(es,"&utm_source=Facebook"),ref:ek,className:"btn w-100 ps-4 pe-4 pt-1 pb-1 text-start",children:[(0,t.jsx)("i",{className:"fab fa-facebook fa-fw"})," Facebook"]})})]});return(0,t.jsxs)(t.Fragment,{children:["default"===a&&(0,t.jsx)("div",{className:"sticky-wrap ".concat(C?"sticky-top":""," functional-area-left d-none d-xl-flex justify-content-center pt-5 ").concat("article"===y?"functional-area-left2":""),style:L,children:(0,t.jsxs)(r.Z,{vertical:!0,className:"align-items-center",children:[I&&(0,t.jsxs)(l.Z,{variant:"outline-primary",className:"func-btn mainLike  sflex-center shadow-sm rounded-circle main-".concat(_,"-Like ").concat(D?"mb-2":"mb-3"),active:J,onClick:eb,"aria-label":"点赞",children:[(0,t.jsx)("i",{className:"far fa-thumbs-up"}),"question"===y||"answer"===y||"product-score"===y?(0,t.jsx)("span",{className:"mainLikeNum ".concat(0!==K?"":"invisible"),children:K}):(0,t.jsx)("span",{className:"mainLikeNum ".concat(K>0?"":"invisible"),children:K})]}),D&&(0,t.jsx)(o.Z,{trigger:"click",placement:"right",show:ed,overlay:eg,children:(0,t.jsx)(l.Z,{variant:"outline-secondary",className:"shadow-sm func-btn sflex-center rounded-circle main-".concat(_,"-Like main-hate mb-3"),active:z,onClick:ev,onBlur:()=>em(!1),"aria-label":"点踩",children:(0,t.jsx)("i",{className:"far fa-thumbs-down fa-flip-horizontal"})})}),F&&(0,t.jsx)(l.Z,{variant:"outline-secondary",className:"func-btn sflex-center rounded-circle mb-2",onClick:ep,active:V,"aria-label":"收藏",children:(0,t.jsx)("i",{className:"far fa-bookmark"})}),Z&&(0,t.jsx)("a",{className:"func-btn sflex-center btn btn-outline-secondary rounded-circle mb-2",href:"#comment-area","aria-label":"评论",children:(0,t.jsx)("i",{className:"far fa-message-lines"})}),M&&(0,t.jsxs)(i.Z,{children:[(0,t.jsx)(i.Z.Toggle,{as:f.Z,className:"func-btn nav-tab-item  rounded-pill btn btn-outline-secondary sflex-center rounded-circle",id:"actions-toggle",children:(0,t.jsx)("i",{className:"far fa-share-nodes"})}),(0,t.jsx)(i.Z.Menu,{className:"dropdown-menu-down",show:w,children:ew})]})]})}),"btnGroup"===a&&(0,t.jsx)("div",{className:"functional-area-bottom text-center",children:(0,t.jsxs)(r.Z,{className:"btn-group like-group align-items-center",role:"group",children:[(0,t.jsxs)(l.Z,{className:"btn me-2 rounded",variant:"outline-primary",active:J,onClick:eb,children:[(0,t.jsx)("i",{className:"far fa-thumbs-up"}),(0,t.jsx)("span",{className:"ms-1",children:J?"已赞":"赞"}),K>0&&(0,t.jsx)("span",{className:"mainLikeNum ms-1",children:K})]}),F&&(0,t.jsxs)(l.Z,{className:"btn me-2 rounded",variant:"outline-secondary",active:V,onClick:ep,children:[(0,t.jsx)("i",{className:"far fa-bookmark"}),(0,t.jsx)("span",{className:"ms-1",children:V?"已收藏":"收藏"}),R>0&&(0,t.jsx)("span",{className:"ms-1",children:R})]}),!B&&(0,t.jsxs)(i.Z,{className:"bottom-share-wrap",children:[(0,t.jsx)(i.Z.Toggle,{as:f.Z,className:"nav-tab-item btn d-flex justify-content-center align-items-center",id:"share-bottom-toggle",children:(0,t.jsxs)(l.Z,{className:"btn rounded",variant:"outline-secondary",active:!1,children:[(0,t.jsx)("i",{className:"far fa-share-nodes"}),(0,t.jsx)("span",{className:"ms-1",children:"分享"})]})}),(0,t.jsx)(i.Z.Menu,{className:"dropdown-menu-down",children:ew})]})]})}),"fixBottom"===a&&(0,t.jsxs)("div",{className:"w-100 fixed-bottom-action d-flex align-items-center ",children:["article"===y&&(0,t.jsxs)("a",{className:"text-center text-body w-25",onClick:eb,children:[J?(0,t.jsx)("i",{className:"fas fa-thumbs-up"}):(0,t.jsx)("i",{className:"far fa-thumbs-up"}),K>0&&(0,t.jsx)("span",{className:"mainLikeNum ms-1",children:K})]}),"question"===y&&(0,t.jsxs)("a",{className:"text-center text-body w-25",onClick:e=>{e.preventDefault()},children:[(0,t.jsx)("i",{className:"far fa-eye"}),A>0&&(0,t.jsx)("span",{className:"mainLikeNum ms-1",children:A})]}),(0,t.jsxs)("a",{className:"text-center text-body w-25",onClick:e=>{e.preventDefault(),ep()},children:[V?(0,t.jsx)("i",{className:"fas fa-bookmark"}):(0,t.jsx)("i",{className:"far fa-bookmark"}),R>0&&(0,t.jsx)("span",{className:"mainLikeNum ms-1",children:R})]}),(0,t.jsxs)("a",{className:"text-center text-body w-25",href:"#comment-area",children:[(0,t.jsx)("i",{className:"far fa-message-lines"}),O>0&&(0,t.jsx)("span",{className:"mainLikeNum ms-1",children:O})]}),!B&&eu&&(0,t.jsx)("a",{className:"text-center text-body w-25",onClick:e=>{e.preventDefault(),eN()},children:(0,t.jsx)("i",{className:"far fa-share-nodes text-body"})}),!B&&!eu&&(0,t.jsxs)(i.Z,{className:"bottom-share-wrap w-25 text-center ",children:[(0,t.jsx)(i.Z.Toggle,{as:"a",id:"share-bottom-toggle",children:(0,t.jsx)("i",{className:"far fa-share-nodes text-body"})}),(0,t.jsx)(i.Z.Menu,{className:"dropdown-menu-down",children:ew})]})]}),(0,t.jsx)(k.Z,{id:s,isShow:ee,setShowStatus:ea,setBookmarkedState:ej,source:y,isBookmarked:U}),(0,t.jsx)("canvas",{hidden:!0,className:"qrcode"})]})};a.Z=(0,h.$j)(e=>{let{global:a}=e;return{isBaiduOxApp:a.isBaiduOxApp,sessionUser:a.sessionUser}})(n.memo(v))},76734:function(e,a,s){var t=s(11527),n=s(50959);let c=(e,a)=>{let{children:s,onClick:n,className:c,domType:i="a"}=e;return"a"===i?(0,t.jsx)("a",{href:"###",className:c,ref:a,tabIndex:-1,onClick:e=>{e.preventDefault(),n(e)},children:s}):"button"===i?(0,t.jsx)("button",{className:c,ref:a,onClick:e=>{e.preventDefault(),n(e)}}):(0,t.jsx)("div",{className:c,ref:a,onClick:e=>{e.preventDefault(),n(e)},children:s})};a.Z=n.forwardRef(c)},57448:function(e,a,s){var t=s(11527),n=s(50959),c=s(92061),i=s(28554),r=s(23970),l=s(80787),o=s(67128),d=s(87710);let m=e=>{let{id:a,setBookmarkedState:s,isShow:r,setShowStatus:m,sessionUser:u,source:h="",isBookmarked:x=!1}=e,[f,k]=(0,n.useState)(!1),[b,p]=(0,n.useState)([]),[j,v]=(0,n.useState)([]),[N,g]=(0,n.useState)({value:"",isInvalid:!1,errorMsg:""}),[w,y]=(0,n.useState)(""),[Z,S]=(0,n.useState)(1);(0,n.useEffect)(()=>{u&&r&&C()},[r]);let C=async()=>{let e=await (0,d.XxZ)({objectId:a});(null==e?void 0:e.rows)&&(p(e.rows),v(e.rows.filter(e=>e.is_bookmarked).map(e=>e.id)))},L=()=>{m(!1),k(!1),g({value:"",isInvalid:!1,errorMsg:""}),y(""),S(1)},_=e=>{e.is_bookmarked?v(j.filter(a=>a!==e.id)):v([...j,e.id]),p(b.map(a=>(e.id===a.id&&(a.is_bookmarked=e.is_bookmarked?0:1),a)))},I=async()=>{if(f){if(!N.value){g({...N,isInvalid:!0,errorMsg:"名称必填"});return}await (0,d.Tlc)({name:N.value,description:w,is_private:Z}).catch(e=>{if(null==e?void 0:e.isError){g({...N,isInvalid:!0,errorMsg:e.name});return}}),C(),k(!f)}else(0,d.vjt)({type:h,id:a,is_bookmark:0===j.length?0:1,archive_ids:j}).catch(()=>{s(!1)}),!!j.length!==x&&s(0!==j.length),m(!1)};return(0,t.jsx)(o.Z,{scrollable:!0,show:r,title:f?"创建收藏夹":"收藏",onCancel:L,onOk:I,children:f?(0,t.jsxs)(l.Z,{className:"bookmarklist-form",id:"bookmarkArchives",onSubmit:I,children:[(0,t.jsxs)(c.Z,{controlId:"bookmark.archiveName",className:"mb-3",children:[(0,t.jsx)(i.Z.Label,{className:"required",children:"名称"})," ",(0,t.jsx)(i.Z.Control,{type:"text",className:"form-control",value:N.value,onChange:e=>g({...N,value:e.target.value}),placeholder:"最多输入32个字",maxLength:32,autoComplete:"off",required:!0,isInvalid:N.isInvalid}),(0,t.jsx)(i.Z.Control.Feedback,{type:"invalid",children:N.errorMsg})]}),(0,t.jsxs)(c.Z,{controlId:"bookmark.description",className:"mb-3",children:[(0,t.jsx)(i.Z.Label,{children:"描述"})," ",(0,t.jsx)(i.Z.Control,{as:"textarea",value:w,onChange:e=>y(e.target.value),placeholder:"最多输入256个字",maxLength:256})]}),(0,t.jsxs)("div",{className:"form-check",children:[(0,t.jsx)("input",{className:"form-check-input",type:"radio",name:"isPrivate",value:"1",onChange:()=>S(1),checked:1===Z,id:"bookmark-private"}),(0,t.jsx)("label",{className:"form-check-label",htmlFor:"bookmark-private",children:"私密："}),(0,t.jsx)("span",{className:"text-secondary",children:"仅自己可见"})]}),(0,t.jsxs)("div",{className:"form-check",children:[(0,t.jsx)("input",{className:"form-check-input",type:"radio",name:"isPrivate",onChange:()=>S(0),checked:0===Z,id:"bookmark-public"}),(0,t.jsx)("label",{className:"form-check-label",htmlFor:"bookmark-public",children:"公开："}),(0,t.jsx)("span",{className:"text-secondary",children:"公开后不可再设置为私密"})]})]}):(0,t.jsx)(l.Z,{onSubmit:I,children:(0,t.jsxs)("div",{className:"mb-3",children:[(0,t.jsx)("label",{className:"form-title",children:"添加到收藏夹："}),null==b?void 0:b.map(e=>(0,t.jsxs)("div",{className:"form-check mb-2",children:[(0,t.jsx)("input",{className:"form-check-input",type:"checkbox",name:"bookmarkItem[]",id:e.id,value:e.id,onChange:()=>_(e),checked:!!e.is_bookmarked}),(0,t.jsxs)("label",{className:"form-check-label",htmlFor:e.id,children:[e.name,!!e.is_private&&(0,t.jsx)("span",{className:"text-secondary",children:"（私密）"})]})]},e.id)),(0,t.jsx)("button",{className:"btn btn-link new-bookmark p-0",onClick:()=>k(!0),children:"+ 创建收藏夹"})]})})})};a.Z=(0,r.$j)(e=>{let{global:a}=e;return{sessionUser:a.sessionUser}})(n.memo(m))}}]);